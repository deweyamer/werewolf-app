# 热重载开发指南 🔥

## 自动热重载已配置完成

本项目已经配置好了热重载功能，修改代码后会自动重新加载，无需手动重启服务。

## 🚀 启动开发模式

### 1. 启动后端（支持热重载）
```bash
cd server
npm run dev
```

**后端热重载工具：** `tsx watch`
- 修改 `.ts` 文件后自动重新编译和重启
- 看到 `🎮 Werewolf Server is running` 表示重启完成

### 2. 启动前端（支持热重载）
```bash
cd client
npm run dev
```

**前端热重载工具：** Vite HMR (Hot Module Replacement)
- 修改 `.tsx`、`.ts`、`.css` 文件后自动更新
- 浏览器会自动刷新或热更新组件
- 通常在1秒内完成更新

## 📝 开发流程

1. **启动服务**：按照上面的步骤启动前后端
2. **修改代码**：直接在编辑器中修改代码
3. **自动重载**：保存文件后自动重新加载
4. **查看效果**：刷新浏览器查看更新（前端通常自动刷新）

## 🔍 热重载范围

### 后端热重载
✅ 支持的文件类型：
- `server/src/**/*.ts`
- `shared/src/**/*.ts`

✅ 自动重载的内容：
- 类型定义修改
- 服务逻辑修改
- WebSocket 处理修改
- 路由修改

⚠️ 需要手动重启的情况：
- `package.json` 依赖更新
- 环境变量修改
- TypeScript 配置修改

### 前端热重载
✅ 支持的文件类型：
- `client/src/**/*.tsx`
- `client/src/**/*.ts`
- `client/src/**/*.css`
- `shared/src/**/*.ts`

✅ 热更新模式：
- React 组件：保持状态的热更新
- CSS 样式：即时更新无需刷新
- TypeScript 类型：自动重新编译

⚠️ 需要刷新的情况：
- 修改了状态管理逻辑
- 修改了路由配置
- 修改了 WebSocket 连接逻辑

## 💡 开发技巧

### 1. 同时查看前后端日志
**方法1：使用分屏终端**
- VSCode：终端面板分屏
- 左侧运行：`cd server && npm run dev`
- 右侧运行：`cd client && npm run dev`

**方法2：使用并发运行（根目录）**
```bash
npm run dev
```
（需要安装 concurrently：`npm install -D concurrently`）

### 2. 监控文件变化
后端重启时会显示：
```
[tsx] restarting due to changes...
🎮 Werewolf Server is running on port 3001
```

前端更新时会显示：
```
[vite] hmr update /src/pages/GodConsole.tsx
```

### 3. 调试技巧
- **后端**：使用 `console.log()` 查看终端输出
- **前端**：使用浏览器开发者工具（F12）查看 Console
- **WebSocket**：浏览器控制台查看 `WebSocket connected` 等日志

### 4. 清除缓存重启
如果遇到奇怪问题，尝试：

**清除后端缓存：**
```bash
cd server
rm -rf dist
npm run dev
```

**清除前端缓存：**
```bash
cd client
rm -rf node_modules/.vite
npm run dev
```

## 🐛 常见问题

### Q1: 修改代码后没有自动重载？
**解决方案：**
1. 检查终端是否有错误信息
2. 确认文件已保存（Ctrl+S）
3. 检查是否在正确的目录运行
4. 重启开发服务器

### Q2: 前端报错"Cannot connect to server"？
**解决方案：**
1. 确认后端已启动（http://localhost:3001）
2. 检查后端终端没有报错
3. 刷新浏览器页面

### Q3: TypeScript 类型错误但代码能运行？
**解决方案：**
- 热重载不会阻止运行，但应该修复类型错误
- 运行 `npm run build` 查看完整的类型错误

### Q4: WebSocket 连接在热重载后断开？
**解决方案：**
- 这是正常现象，刷新浏览器页面即可重新连接
- 或者修改代码添加自动重连逻辑

## 📊 热重载性能

| 操作 | 后端重启时间 | 前端更新时间 |
|-----|-------------|-------------|
| 修改组件UI | - | ~200ms |
| 修改服务逻辑 | ~1-2s | - |
| 修改类型定义 | ~1-2s | ~500ms |
| 修改样式 | - | ~100ms |

## ⚡ 最佳实践

1. **保持服务运行**：开发时始终保持前后端服务运行
2. **小步修改**：每次修改少量代码，便于快速定位问题
3. **及时保存**：养成频繁保存的习惯（Ctrl+S）
4. **查看日志**：注意终端输出，及时发现错误
5. **测试修改**：每次修改后简单测试功能是否正常

## 🎯 本次更新的热重载特性

本次优化添加了以下自动更新功能：

✅ **上帝控制台实时状态显示**
- 修改后自动更新UI
- 实时显示玩家操作状态
- 自动刷新神职技能状态

✅ **玩家操作反馈**
- 预言家查验结果即时显示
- 女巫查看被刀信息
- 操作成功/失败实时提示

✅ **WebSocket 状态同步**
- 游戏状态自动广播
- 所有客户端实时同步

---

**现在开始开发吧！** 🚀

修改代码后，保存文件，服务会自动重新加载，浏览器会自动更新显示。
