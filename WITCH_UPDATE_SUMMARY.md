# 女巫界面更新总结 🧪

## 更新日期
2025-01-XX

## 更新内容

本次更新完全重新设计了女巫的操作界面，使其符合用户需求和狼人杀游戏规则。

---

## 核心改进

### 1. 分离的药水操作 💊 ☠️

**之前**: 单一的目标选择下拉框

**现在**:
- 解药区域：独立的两个按钮（"使用解药" / "不使用"）
- 毒药区域：独立的两个按钮（"使用毒药" / "不使用"）

### 2. 互斥使用机制 🔄

- 选择解药后，毒药按钮自动禁用
- 选择毒药后，解药按钮自动禁用
- 同一轮只能使用一种药水

### 3. 自动显示被刀信息 📢

- 女巫进入阶段时，界面顶部显示"昨晚被刀: X号"
- 持续显示，不是一次性弹窗
- 红色背景高亮显示

### 4. 实时技能状态 📊

```
你的技能状态
解药 ✓ 可用    毒药 ✓ 可用
```

- 绿色 ✓ = 解药可用
- 红色 ✓ = 毒药可用
- 灰色 ✗ = 已使用

### 5. 毒药目标选择弹窗 🎯

- 点击"使用毒药"后弹出模态框
- 下拉选择框显示所有活着的玩家
- 必须选择目标才能确认
- 支持取消操作

---

## 修改的文件

### `client/src/pages/PlayerView.tsx`

**新增状态变量**:
```typescript
const [witchAction, setWitchAction] = useState<'none' | 'antidote' | 'poison'>('none');
const [showPoisonModal, setShowPoisonModal] = useState(false);
const [poisonTarget, setPoisonTarget] = useState<number>(0);
```

**新增函数**:
- `handleWitchSubmit()` - 女巫提交操作
- `handleUseAntidote()` - 使用解药
- `handleNoAntidote()` - 不使用解药
- `handleUsePoisonClick()` - 使用毒药（打开弹窗）
- `handleNoPoison()` - 不使用毒药
- `handleConfirmPoison()` - 确认毒药目标

**新增UI组件**:
- 女巫专用操作面板（替换通用操作面板）
- 被刀信息显示区域
- 技能状态显示区域
- 解药操作按钮组
- 毒药操作按钮组
- 毒药目标选择模态弹窗

---

## 使用示例

### 场景1: 女巫使用解药

1. 进入女巫阶段
2. 看到"昨晚被刀: 3号"
3. 查看技能状态：解药 ✓ 可用
4. 点击"使用解药"（按钮变绿）
5. 毒药按钮自动变灰（禁用）
6. 点击"提交操作"
7. 完成！

### 场景2: 女巫使用毒药

1. 进入女巫阶段
2. 查看技能状态：毒药 ✓ 可用
3. 点击"使用毒药"
4. 弹出目标选择框
5. 选择"5号 - test5"
6. 点击"确认"（弹窗关闭，按钮变红）
7. 解药按钮自动变灰（禁用）
8. 点击"提交操作"
9. 完成！

### 场景3: 女巫不使用药水

1. 进入女巫阶段
2. 直接点击"不使用"（解药或毒药区域都可以）
3. 点击"提交操作"
4. 完成！

---

## 视觉效果

### 按钮颜色状态

| 状态 | 解药 | 毒药 |
|-----|------|------|
| 可用未选中 | 🟢 绿色半透明 | 🔴 红色半透明 |
| 已选中 | 🟢 绿色实心 | 🔴 红色实心 |
| 禁用 | ⚫ 灰色 | ⚫ 灰色 |

### 界面布局

```
┌────────────────────────────────┐
│ 🧪 女巫阶段                     │
├────────────────────────────────┤
│ ┌──────────────────────────┐   │
│ │ 昨晚被刀: 3号             │ ← 红色背景
│ └──────────────────────────┘   │
│                                │
│ 你的技能状态                    │
│ 解药 ✓ 可用  毒药 ✓ 可用       │
│                                │
│ 💊 解药                        │
│ [使用解药] [不使用]             │
│                                │
│ ☠️ 毒药                        │
│ [使用毒药] [不使用]             │
│                                │
│      [提交操作]                 │
└────────────────────────────────┘
```

---

## 技术细节

### 互斥逻辑

```typescript
// 解药按钮禁用条件
disabled={!myPlayer.abilities.antidote || witchAction === 'poison'}

// 毒药按钮禁用条件
disabled={!myPlayer.abilities.poison || witchAction === 'antidote'}
```

### 状态重置

提交操作后自动重置所有状态：
```typescript
setWitchAction('none');
setPoisonTarget(0);
setShowPoisonModal(false);
```

### 被刀信息来源

从游戏状态中读取：
```typescript
currentGame.nightActions.witchKnowsVictim
```

---

## 兼容性

- ✅ 与现有游戏逻辑完全兼容
- ✅ 不影响其他角色的操作界面
- ✅ 后端无需修改（使用现有的 submitAction API）
- ✅ 支持热重载（Vite HMR）

---

## 测试建议

### 测试用例

1. **解药测试**
   - [ ] 有解药时能点击"使用解药"
   - [ ] 解药用完后按钮变灰
   - [ ] 选择解药后毒药按钮禁用
   - [ ] 提交后状态正确重置

2. **毒药测试**
   - [ ] 有毒药时能点击"使用毒药"
   - [ ] 点击后弹窗正常显示
   - [ ] 必须选择目标才能确认
   - [ ] 取消后状态正确重置
   - [ ] 选择毒药后解药按钮禁用

3. **互斥测试**
   - [ ] 选择解药后不能选毒药
   - [ ] 选择毒药后不能选解药
   - [ ] 可以在解药和"不使用"之间切换
   - [ ] 可以在毒药和"不使用"之间切换

4. **被刀信息测试**
   - [ ] 进入阶段时正确显示被刀玩家
   - [ ] 被刀信息持续显示不消失
   - [ ] 没有被刀信息时不显示该区域

5. **提交测试**
   - [ ] 使用解药提交成功
   - [ ] 使用毒药提交成功
   - [ ] 不使用提交成功
   - [ ] 提交后收到正确反馈

---

## 后续优化建议

1. **动画效果**: 添加按钮点击和弹窗出现的过渡动画
2. **确认提示**: 提交前显示确认信息（"你选择了使用解药"）
3. **操作历史**: 显示本局已使用的药水历史
4. **快捷键**: 支持键盘快捷键操作（1=解药，2=毒药）
5. **音效**: 添加按钮点击和操作成功的音效

---

## 相关文档

- [WITCH_INTERFACE.md](./WITCH_INTERFACE.md) - 详细的接口设计文档
- [QUICK_START.md](./QUICK_START.md) - 快速开始指南
- [USER_GUIDE.md](./USER_GUIDE.md) - 完整使用指南
- [HOT_RELOAD.md](./HOT_RELOAD.md) - 热重载开发指南

---

## 更新完成 ✅

女巫界面已经完全重新设计，现在更加直观、易用、符合游戏规则！

**立即体验**: 启动开发服务器，登录女巫玩家账号，进入witch阶段即可看到新界面！ 🎮✨
