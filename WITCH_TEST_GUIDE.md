# 女巫界面测试指南 🧪

## 快速测试步骤

### 前置准备

1. **启动服务**
```bash
# 终端1 - 后端
cd werewolf-app/server
npm run dev

# 终端2 - 前端
cd werewolf-app/client
npm run dev
```

2. **创建游戏**
- 浏览器打开: http://localhost:3000
- 登录上帝账号: `god` / `god`
- 创建房间，记住房间码（例如：ABC123）

3. **加入玩家**
打开12个浏览器标签页，依次登录：
- test1 ~ test12 / test
- 输入房间码加入

4. **分配角色**
- 回到上帝页面
- 点击"分配角色"
- 点击"🎲 随机分配"
- 点击"确认分配"
- **记住女巫的号位**（例如：5号是女巫）

5. **开始游戏**
- 点击"开始游戏"

---

## 测试场景

### 测试1: 查看女巫界面 👀

**步骤**:
1. 切换到女巫玩家的标签页（例如test5）
2. 等待进入女巫阶段（上帝需要先点几次"进入下一阶段"）

**预期结果**:
- ✅ 看到标题 "🧪 女巫阶段"
- ✅ 看到技能状态区域
- ✅ 看到"💊 解药"区域，两个按钮
- ✅ 看到"☠️ 毒药"区域，两个按钮
- ✅ 看到"提交操作"按钮

**截图位置**: 顶部应该显示女巫界面

---

### 测试2: 被刀信息显示 📢

**前置条件**: 狼人刀了一个人（例如3号）

**步骤**:
1. 上帝推进到女巫阶段
2. 切换到女巫玩家标签页

**预期结果**:
- ✅ 界面顶部显示红色区域
- ✅ 显示文本"昨晚被刀: 3号"
- ✅ 信息持续显示，不消失

**错误情况**:
- ❌ 没有显示被刀信息 → 检查狼人是否刀了人
- ❌ 显示为弹窗 → 代码有误

---

### 测试3: 技能状态显示 📊

**场景A: 第一晚（技能都可用）**

**预期结果**:
```
你的技能状态
解药 ✓ 可用    毒药 ✓ 可用
```
- ✅ "解药"显示绿色 ✓
- ✅ "毒药"显示红色 ✓

**场景B: 解药用过**

**预期结果**:
```
你的技能状态
解药 ✗ 已使用  毒药 ✓ 可用
```
- ✅ "解药"显示灰色 ✗
- ✅ "毒药"显示红色 ✓

---

### 测试4: 使用解药 💊

**步骤**:
1. 进入女巫阶段
2. 确认有解药（✓ 可用）
3. 点击"使用解药"按钮

**预期结果**:
- ✅ "使用解药"按钮变为绿色实心
- ✅ 毒药区域的两个按钮都变灰（禁用）
- ✅ 点击"提交操作"
- ✅ 提示"操作成功"

**错误情况**:
- ❌ 毒药按钮没有禁用 → 互斥逻辑错误
- ❌ 提交失败 → 检查后端

---

### 测试5: 使用毒药 ☠️

**步骤**:
1. 进入女巫阶段
2. 确认有毒药（✓ 可用）
3. 点击"使用毒药"按钮

**预期结果 - 第1步（弹窗）**:
- ✅ 弹出模态框
- ✅ 标题"选择毒药目标"
- ✅ 下拉框显示所有活着的玩家
- ✅ 默认选项"请选择..."
- ✅ 有"确认"和"取消"按钮

**步骤（续）**:
4. 在下拉框选择一个玩家（例如：7号）
5. 点击"确认"

**预期结果 - 第2步（确认后）**:
- ✅ 弹窗关闭
- ✅ "使用毒药"按钮变为红色实心
- ✅ 解药区域的两个按钮都变灰（禁用）

**步骤（续）**:
6. 点击"提交操作"

**预期结果 - 第3步（提交）**:
- ✅ 提示"操作成功"
- ✅ 按钮状态重置

**错误情况**:
- ❌ 弹窗没出现 → 检查 showPoisonModal 状态
- ❌ 解药没禁用 → 互斥逻辑错误
- ❌ 没有选目标就能确认 → 缺少验证

---

### 测试6: 取消毒药操作 🚫

**步骤**:
1. 点击"使用毒药"
2. 弹出目标选择框
3. 点击"取消"

**预期结果**:
- ✅ 弹窗关闭
- ✅ witchAction 重置为 'none'
- ✅ 所有按钮恢复到初始状态
- ✅ 可以重新选择解药或毒药

**错误情况**:
- ❌ 按钮状态没恢复 → 取消逻辑错误

---

### 测试7: 不使用药水 ⭕

**步骤**:
1. 进入女巫阶段
2. 直接点击"不使用"（解药或毒药区域都可以）
3. 点击"提交操作"

**预期结果**:
- ✅ 提示"操作成功"
- ✅ 女巫不使用任何药水

---

### 测试8: 互斥控制 🔄

**场景A: 选解药后不能选毒药**

**步骤**:
1. 点击"使用解药"
2. 尝试点击"使用毒药"

**预期结果**:
- ✅ 毒药按钮无法点击（灰色禁用）
- ✅ 鼠标悬停时没有hover效果

**场景B: 选毒药后不能选解药**

**步骤**:
1. 点击"使用毒药"（弹出弹窗）
2. 选择目标并确认
3. 尝试点击"使用解药"

**预期结果**:
- ✅ 解药按钮无法点击（灰色禁用）

---

### 测试9: 切换操作 🔀

**步骤**:
1. 点击"使用解药"（按钮变绿）
2. 点击"不使用"（解药区域的按钮）

**预期结果**:
- ✅ "使用解药"按钮恢复为半透明
- ✅ "不使用"按钮高亮
- ✅ 毒药按钮恢复可用

**步骤（续）**:
3. 点击"使用毒药"（弹出弹窗）
4. 点击"取消"
5. 点击"使用解药"

**预期结果**:
- ✅ 可以自由切换
- ✅ 互斥关系始终生效

---

### 测试10: 技能用完后 🚫

**场景**: 女巫解药已用

**预期结果**:
- ✅ 技能状态显示"解药 ✗ 已使用"
- ✅ "使用解药"按钮灰色禁用
- ✅ "不使用"按钮灰色禁用
- ✅ 只有毒药区域可操作

**场景**: 女巫两个药都用完

**预期结果**:
- ✅ 技能状态都显示 ✗
- ✅ 所有按钮都禁用
- ✅ 只能点击"提交操作"（不使用）

---

### 测试11: 状态重置 🔄

**步骤**:
1. 点击"使用解药"
2. 提交操作
3. 下一轮再次进入女巫阶段

**预期结果**:
- ✅ witchAction 重置为 'none'
- ✅ 所有按钮恢复初始状态
- ✅ 解药按钮显示已使用（禁用）

---

### 测试12: 多轮测试 🔁

**场景**: 第一晚用解药，第二晚用毒药

**第一晚**:
1. 使用解药 → 提交成功

**第二晚**:
1. 解药按钮禁用 ✅
2. 毒药按钮可用 ✅
3. 使用毒药 → 选择目标 → 提交成功

**第三晚**:
1. 解药和毒药都禁用 ✅
2. 只能提交"不使用" ✅

---

## 快速检查清单 ✅

### UI显示
- [ ] 女巫阶段标题显示正确
- [ ] 被刀信息显示（红色背景）
- [ ] 技能状态显示（绿色/红色/灰色）
- [ ] 解药区域（💊 图标 + 两个按钮）
- [ ] 毒药区域（☠️ 图标 + 两个按钮）
- [ ] 提交按钮显示

### 解药功能
- [ ] 有解药时"使用解药"可点击
- [ ] 点击后按钮变绿
- [ ] 选择解药后毒药禁用
- [ ] 解药用完后按钮禁用
- [ ] 提交成功

### 毒药功能
- [ ] 有毒药时"使用毒药"可点击
- [ ] 点击后弹出目标选择框
- [ ] 下拉框显示所有活着的玩家
- [ ] 必须选择目标才能确认
- [ ] 确认后按钮变红
- [ ] 选择毒药后解药禁用
- [ ] 毒药用完后按钮禁用
- [ ] 提交成功

### 互斥控制
- [ ] 选解药时毒药禁用
- [ ] 选毒药时解药禁用
- [ ] 可以在"使用"和"不使用"之间切换
- [ ] 取消操作后状态正确重置

### 状态管理
- [ ] 提交后状态重置
- [ ] 下一轮正确显示技能状态
- [ ] 用完的技能持续禁用

---

## 常见问题排查 🔍

### Q1: 女巫界面没有显示
**检查**:
- 当前玩家是否是女巫角色
- 当前阶段是否是 'witch'
- PlayerView.tsx 中的条件判断是否正确

### Q2: 被刀信息不显示
**检查**:
- `currentGame.nightActions.witchKnowsVictim` 是否有值
- 狼人是否已经刀了人
- 后端是否正确设置了 witchKnowsVictim

### Q3: 按钮点击无反应
**检查**:
- 按钮是否被禁用（灰色）
- 浏览器控制台是否有错误
- 事件处理函数是否正确绑定

### Q4: 互斥不生效
**检查**:
- `witchAction` 状态是否正确更新
- 按钮 disabled 属性的条件判断
- 状态更新是否触发了重新渲染

### Q5: 提交失败
**检查**:
- WebSocket 连接是否正常
- 提交的 action 数据格式是否正确
- 后端 submitAction 逻辑是否正确

---

## 性能测试 ⚡

### 响应速度
- [ ] 点击按钮立即响应（<100ms）
- [ ] 弹窗打开/关闭流畅（<200ms）
- [ ] 状态更新实时（<100ms）
- [ ] 提交操作快速（<500ms）

### 内存使用
- [ ] 打开女巫界面内存正常
- [ ] 多次操作不会内存泄漏
- [ ] 状态重置后内存释放

---

## 测试报告模板 📝

```
测试日期: ____________________
测试人员: ____________________
浏览器: ____________________

┌─────────────────────────────┬──────┬────────┐
│ 测试项目                     │ 结果 │ 备注   │
├─────────────────────────────┼──────┼────────┤
│ 女巫界面显示                 │ ✅   │        │
│ 被刀信息显示                 │ ✅   │        │
│ 技能状态显示                 │ ✅   │        │
│ 使用解药                     │ ✅   │        │
│ 使用毒药                     │ ✅   │        │
│ 取消毒药                     │ ✅   │        │
│ 不使用药水                   │ ✅   │        │
│ 互斥控制                     │ ✅   │        │
│ 状态重置                     │ ✅   │        │
│ 多轮测试                     │ ✅   │        │
└─────────────────────────────┴──────┴────────┘

发现的问题:
1.
2.
3.

建议改进:
1.
2.
3.
```

---

**开始测试吧！** 🚀✨
