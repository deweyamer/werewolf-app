# 狼人杀项目 TODO 清单

> 最后更新: 2025-12-22
> 状态: ✅ 已完成 | 🔄 进行中 | ⏳ 待处理 | ❌ 已失败

---

## 📊 总体进度

| 模块 | 完成度 | 状态 |
|------|--------|------|
| 后端核心逻辑 | 100% | ✅ 已完成 |
| 后端 E2E 测试 | 93.3% | 🔄 进行中 (1个失败) |
| 前端核心功能 | 100% | ✅ 已完成 |
| 前端单元测试 | 100% | ✅ 已完成 (69/69通过) |
| 前端组件测试 | 50% | 🔄 进行中 |
| 部署配置 | 100% | ✅ 已完成 |

---

## 🔴 P0 - 紧急修复 (Critical)

### 后端

#### ❌ 1. 石像鬼查验返回 undefined
**文件**: `server/src/game/roles/GargoyleHandler.ts`
**问题**: 石像鬼技能查验时返回 undefined 而非角色信息
**详情**:
```
测试: 【守墓人石像鬼】石像鬼查验具体角色
期望: { role: 'seer', camp: 'good' }
实际: undefined
```
**位置**: [E2E_TESTING_SUMMARY.md:230](server/E2E_TESTING_SUMMARY.md#L230)
**优先级**: P1-CRITICAL
**影响**: 核心角色技能失效

---

## 🟡 P1 - 重要功能 (Important)

### 后端测试

#### ⏳ 2. 狼美人连结机制验证
**文件**: `server/src/test/E2EScenarioTest.test.ts:306`
**TODO**: 具体验证连结机制（取决于实现）
**描述**: 需要验证狼美人与魅惑目标的连结死亡逻辑
**相关代码**:
```typescript
// TODO: 具体验证连结机制（取决于实现）
// 应验证: 当狼美人死亡时，魅惑的玩家是否同时死亡
```
**建议**:
- 检查游戏历史中是否记录了连结事件
- 验证死亡原因为 `wolf_beauty_link`
- 确认双方同时死亡的时机

#### ⏳ 3. 狼美人投票放逐后连结死亡
**文件**: `server/src/test/E2EScriptTests.ts:411`
**TODO**: 在白天投票放逐狼美人，验证10号是否连结死亡
**描述**: 测试完整的狼美人连结场景
**测试步骤**:
1. 第1回合夜晚: 狼美人魅惑10号
2. 第2回合白天: 投票放逐狼美人
3. 验证: 10号是否同时死亡
4. 验证: 死亡原因为 `wolf_beauty_link`

#### ⏳ 4. 骑士决斗逻辑测试
**文件**: `server/src/test/README.md:187`
**TODO**: 添加决斗逻辑测试
**描述**: 需要完整测试骑士决斗的各种情况
**测试场景**:
- 决斗好人成功 → 对方死亡
- 决斗狼人失败 → 骑士死亡
- 决斗后的技能状态更新
- 决斗与其他技能的交互

---

## 🟢 P2 - 功能增强 (Nice to Have)

### 前端组件测试

#### ⏳ 5. GodConsole 完整组件测试
**文件**: `client/src/pages/GodConsole.test.tsx`
**状态**: 基础测试已完成 (18个测试通过)
**待补充**:
- [ ] 实时状态更新验证
- [ ] 用户交互测试 (分配角色、推进阶段)
- [ ] 导出复盘功能测试
- [ ] WebSocket 消息处理测试
- [ ] 错误处理和边界情况

**参考**: [FRONTEND_TEST_SUMMARY.md:283](client/FRONTEND_TEST_SUMMARY.md#L283)

#### ⏳ 6. PlayerView 完整组件测试
**文件**: `client/src/pages/PlayerView.test.tsx`
**状态**: 基础测试已完成 (15个测试通过)
**待补充**:
- [ ] 更多角色特定UI测试 (猎人、骑士、守墓人等)
- [ ] 投票界面交互测试
- [ ] 警长竞选流程测试
- [ ] 技能使用交互测试
- [ ] WebSocket 实时更新测试

**参考**: [FRONTEND_TEST_SUMMARY.md:289](client/FRONTEND_TEST_SUMMARY.md#L289)

#### ⏳ 7. 前端 E2E 测试
**描述**: 完整的端到端测试
**范围**:
- [ ] 完整游戏流程 (创建房间 → 角色分配 → 游戏进行 → 结束)
- [ ] WebSocket 通信测试
- [ ] 多客户端协同测试 (God + Players)
- [ ] 网络异常处理
- [ ] 重连机制验证

**参考**: [FRONTEND_TEST_SUMMARY.md:294](client/FRONTEND_TEST_SUMMARY.md#L294)

### UI/UX 改进

#### ⏳ 8. God Console 视觉优化
**描述**: 提升上帝控制台的可用性
**改进点**:
- [ ] 视觉区分已提交/未提交操作 (使用颜色或图标)
- [ ] 显示操作时间戳
- [ ] 警长竞选投票统计可视化
- [ ] 阶段转换动画
- [ ] 操作确认对话框

**参考**: [FRONTEND_TEST_SUMMARY.md:303](client/FRONTEND_TEST_SUMMARY.md#L303)

#### ⏳ 9. 实时反馈增强
**描述**: 提升用户交互体验
**改进点**:
- [ ] 操作确认动画
- [ ] 阶段转换提示音效
- [ ] 错误提示优化 (更友好的错误信息)
- [ ] 加载状态指示器
- [ ] 操作撤销功能 (适用场景)

**参考**: [FRONTEND_TEST_SUMMARY.md:308](client/FRONTEND_TEST_SUMMARY.md#L308)

---

## ✅ 已完成的重要项目

### 后端
- ✅ 完整的游戏流程引擎 (GameFlowEngine)
- ✅ 所有角色技能处理器
- ✅ 投票系统 (警长竞选、放逐投票)
- ✅ 技能优先级和冲突解决 (SkillResolver)
- ✅ 死亡原因枚举统一 (snake_case)
- ✅ 守墓人验尸规则实现
- ✅ E2E 测试框架 (14/15 通过)

### 前端
- ✅ GodConsole 基础功能和 UI
- ✅ PlayerView 角色特定 UI
- ✅ 死亡原因翻译适配
- ✅ 守墓人规则 UI 提示
- ✅ 信息隔离安全性修复
- ✅ 前端测试框架配置
- ✅ 工具函数单元测试 (100% 通过)
- ✅ 后端适配集成测试 (100% 通过)
- ✅ 组件基础测试 (69/69 通过)

### 文档
- ✅ E2E 测试框架文档
- ✅ 前端测试文档
- ✅ 批判性分析报告
- ✅ 部署指南 (Vercel + 阿里云)
- ✅ 用户使用手册

---

## 📝 实施建议

### 优先级排序

1. **立即修复 (本周)**:
   - ❌ 石像鬼查验 bug (#1)

2. **本月完成**:
   - ⏳ 狼美人连结测试 (#2, #3)
   - ⏳ 骑士决斗测试 (#4)

3. **下个迭代**:
   - ⏳ 前端组件完整测试 (#5, #6)
   - ⏳ 前端 E2E 测试 (#7)

4. **长期改进**:
   - ⏳ UI/UX 优化 (#8, #9)

### 工作量估算

| 任务 | 预估工时 | 难度 |
|------|----------|------|
| #1 石像鬼 bug | 2-4h | 中 |
| #2 狼美人连结验证 | 2-3h | 低 |
| #3 狼美人投票测试 | 3-4h | 中 |
| #4 骑士决斗测试 | 4-6h | 中 |
| #5 GodConsole 测试 | 8-12h | 中 |
| #6 PlayerView 测试 | 8-12h | 中 |
| #7 前端 E2E | 16-24h | 高 |
| #8 God Console 优化 | 6-8h | 低 |
| #9 实时反馈增强 | 6-8h | 低 |

**总计**: 约 55-81 小时

---

## 🔍 代码中的 TODO 注释

### 后端

1. **E2EScenarioTest.test.ts:306**
   ```typescript
   // TODO: 具体验证连结机制（取决于实现）
   ```

2. **E2EScriptTests.ts:411**
   ```typescript
   // TODO: 在白天投票放逐狼美人，验证10号是否连结死亡
   ```

3. **README.md:187**
   ```typescript
   // TODO: 添加决斗逻辑测试
   ```

### 前端
- ✅ 前端代码中无 TODO 注释

---

## 📞 相关文档链接

- [后端 E2E 测试总结](server/E2E_TESTING_SUMMARY.md)
- [后端测试覆盖率报告](server/TEST_COVERAGE_REPORT.md)
- [前端测试总结](client/FRONTEND_TEST_SUMMARY.md)
- [前端测试使用文档](client/TEST_README.md)
- [批判性分析报告](client/CRITICAL_ISSUES_ANALYSIS.md)

---

## 📌 注意事项

1. **石像鬼 bug (#1)** 是当前唯一的失败测试，需要优先修复
2. 所有前端核心测试已通过 (69/69)，质量有保障
3. 后端测试通过率 93.3% (14/15)，接近生产就绪
4. 组件测试和 E2E 测试属于增强项，不影响核心功能
5. UI/UX 优化可以根据用户反馈逐步推进

---

**最后更新**: 2025-12-22
**维护者**: Claude Code
**项目状态**: 🟢 核心功能稳定，增强功能持续开发中
